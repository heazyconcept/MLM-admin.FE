<p-dialog 
  [visible]="visible()" 
  [modal]="true" 
  [header]="title"
  [draggable]="false" 
  [resizable]="false"
  [style]="{ width: '450px' }"
  styleClass="modern-dialog"
  (onHide)="onCancel()">
  
  <div class="flex flex-col gap-6 pt-2">
    <!-- Payment Summary -->
    <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
      <div class="flex justify-between items-center mb-1">
        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Transaction</span>
        <span class="text-[10px] font-mono text-gray-500">{{ payment()?.id }}</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-sm font-medium text-gray-700">{{ payment()?.userName }}</span>
        <span class="text-lg font-bold text-gray-900">{{ payment()?.amount | currency:payment()?.currency }}</span>
      </div>
    </div>

    <!-- Warning for Irreversible Actions -->
    @if (isIrreversible) {
      <div class="flex gap-3 p-3 bg-red-50 rounded-lg border border-red-100">
        <i class="pi pi-exclamation-triangle text-red-600 mt-0.5"></i>
        <p class="text-[11px] font-medium text-red-700 leading-normal">
          <strong>Warning:</strong> This action is irreversible. Please ensure all details are verified before proceeding.
        </p>
      </div>
    }

    <!-- Manual Confirmation Flow (Proof Upload) -->
    @if (isManualConfirmation) {
      <div class="space-y-4">
        <div class="space-y-2">
          <label class="text-xs font-bold text-gray-400 uppercase tracking-widest">Upload Payment Proof <span class="text-red-500">*</span></label>
          <div 
            class="flex flex-col items-center justify-center p-6 border-2 border-dashed rounded-xl transition-colors cursor-pointer"
            [class.border-brand-green-200]="fileSelected()"
            [class.bg-brand-green-50/50]="fileSelected()"
            [class.border-gray-200]="!fileSelected()"
            [class.hover:bg-gray-50]="!fileSelected()"
            (click)="fileInput.click()"
            tabindex="0"
            (keydown.enter)="fileInput.click()">
            <input #fileInput type="file" class="hidden" (change)="onFileSelect($event)">
            <i class="pi pi-upload text-2xl mb-2" [class.text-brand-green-600]="fileSelected()" [class.text-gray-300]="!fileSelected()"></i>
            @if (fileSelected()) {
              <p class="text-sm font-semibold text-brand-green-700">Proof document attached</p>
              <p class="text-[10px] text-brand-green-600/70">Click to change file</p>
            } @else {
              <p class="text-sm font-medium text-gray-500">Click to select or drag & drop</p>
              <p class="text-[10px] text-gray-400">Supported: PDF, JPG, PNG (Max 5MB)</p>
            }
          </div>
        </div>

        <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
          <p-checkbox [formControl]="confirmedCheckControl" [binary]="true" inputId="confirmCheck"></p-checkbox>
          <label for="confirmCheck" class="text-xs text-gray-600 cursor-pointer select-none">
            I confirm that I have manually verified the receipt of these funds in the destination bank account.
          </label>
        </div>
      </div>
    }

    <!-- Reason Section (Mandatory for some actions) -->
    @if (action() === 'Fail' || action() === 'Reverse' || action() === 'Flag') {
      <div class="space-y-2">
        <label class="text-xs font-bold text-gray-400 uppercase tracking-widest">
          Reason for {{ action() }} <span class="text-red-500">*</span>
        </label>
        <textarea 
          pTextarea 
          [autoResize]="true" 
          rows="3" 
          class="w-full rounded-xl"
          [placeholder]="'Provide a detailed reason for ' + action()?.toLowerCase() + '...'"
          [formControl]="reasonControl">
        </textarea>
      </div>
    }

    <!-- Action Buttons -->
    <div class="flex gap-3 mt-2">
      <button 
        pButton 
        label="Cancel" 
        class="p-button-outlined p-button-secondary flex-1"
        (click)="onCancel()">
      </button>
      <button 
        pButton 
        [label]="action() === 'ConfirmSuccess' ? 'Confirm Payment' : 'Submit Action'" 
        [class]="action() === 'ConfirmSuccess' ? 'p-button-success' : (action() === 'Flag' ? 'p-button-warning' : 'p-button-danger')"
        class="flex-1"
        [disabled]="confirmDisabled"
        (click)="onConfirm()">
      </button>
    </div>
  </div>
</p-dialog>
