<p-dialog 
  [(visible)]="visible"
  [header]="'User Profile'"
  [modal]="true"
  [style]="{width: '800px', maxHeight: '90vh'}"
  [draggable]="false"
  [resizable]="false"
  (onHide)="close()">
  
  @if (user) {
    <!-- Header with User Info -->
    <div class="flex items-start justify-between pb-4 mb-4 border-b border-gray-100">
      <div class="flex items-center gap-4">
        <div class="w-16 h-16 rounded-full bg-mlm-green-100 flex items-center justify-center">
          <span class="text-2xl font-bold text-mlm-primary">
            {{ user.fullName.charAt(0) }}
          </span>
        </div>
        <div>
          <h3 class="text-xl font-semibold text-mlm-text">{{ user.fullName }}</h3>
          <p class="text-mlm-secondary">&#64;{{ user.username }}</p>
          <div class="flex items-center gap-2 mt-1">
            <app-status-badge [status]="user.status"></app-status-badge>
            <span 
              class="px-2 py-0.5 rounded-full text-xs font-medium text-white"
              [style.background-color]="getPackageColor(user.package)">
              {{ user.package }}
            </span>
            <span class="px-2 py-0.5 rounded-full text-xs font-medium bg-mlm-background text-mlm-secondary">
              {{ user.role }}
            </span>
          </div>
        </div>
      </div>
      <div class="text-right">
        <p class="text-sm text-mlm-secondary">User ID</p>
        <p class="font-mono font-medium text-mlm-text">{{ user.id }}</p>
      </div>
    </div>

    <!-- Tabs -->
    <div class="w-full">
      <!-- Tab Headers -->
      <div class="flex border-b border-gray-200 mb-4">
        <button
          (click)="activeTab = 'basic'"
          [class]="activeTab === 'basic' ? 'px-4 py-2 border-b-2 border-mlm-primary text-mlm-primary font-medium' : 'px-4 py-2 text-mlm-secondary hover:text-mlm-text'">
          Basic Info
        </button>
        <button
          (click)="activeTab = 'contact'"
          [class]="activeTab === 'contact' ? 'px-4 py-2 border-b-2 border-mlm-primary text-mlm-primary font-medium' : 'px-4 py-2 text-mlm-secondary hover:text-mlm-text'">
          Contact
        </button>
        <button
          (click)="activeTab = 'network'"
          [class]="activeTab === 'network' ? 'px-4 py-2 border-b-2 border-mlm-primary text-mlm-primary font-medium' : 'px-4 py-2 text-mlm-secondary hover:text-mlm-text'">
          Network
        </button>
        <button
          (click)="activeTab = 'wallets'"
          [class]="activeTab === 'wallets' ? 'px-4 py-2 border-b-2 border-mlm-primary text-mlm-primary font-medium' : 'px-4 py-2 text-mlm-secondary hover:text-mlm-text'">
          Wallets
        </button>
        <button
          (click)="activeTab = 'activity'"
          [class]="activeTab === 'activity' ? 'px-4 py-2 border-b-2 border-mlm-primary text-mlm-primary font-medium' : 'px-4 py-2 text-mlm-secondary hover:text-mlm-text'">
          Activity Log
        </button>
      </div>

      <!-- Tab Content -->
      <!-- Basic Information -->
      @if (activeTab === 'basic') {
        <div>
        <div class="grid grid-cols-2 gap-4 py-2">
          <div>
            <label class="text-sm text-mlm-secondary">Full Name</label>
            <p class="font-medium text-mlm-text">{{ user.fullName }}</p>
          </div>
          <div>
            <label class="text-sm text-mlm-secondary">Username</label>
            <p class="font-medium text-mlm-text">{{ user.username }}</p>
          </div>
          <div>
            <label class="text-sm text-mlm-secondary">User ID</label>
            <p class="font-mono font-medium text-mlm-text">{{ user.id }}</p>
          </div>
          <div>
            <label class="text-sm text-mlm-secondary">Registration Date</label>
            <p class="font-medium text-mlm-text">{{ formatDate(user.registrationDate) }}</p>
          </div>
          <div>
            <label class="text-sm text-mlm-secondary">Package</label>
            <p class="font-medium text-mlm-text">{{ user.package }}</p>
          </div>
          <div>
            <label class="text-sm text-mlm-secondary">Role</label>
            <p class="font-medium text-mlm-text">{{ user.role }}</p>
          </div>
        </div>
        </div>
      }

      <!-- Contact Details -->
      @if (activeTab === 'contact') {
        <div>
        <div class="grid grid-cols-2 gap-4 py-2">
          <div>
            <label class="text-sm text-mlm-secondary">Email Address</label>
            <p class="font-medium text-mlm-text">{{ user.email }}</p>
          </div>
          <div>
            <label class="text-sm text-mlm-secondary">Phone Number</label>
            <p class="font-medium text-mlm-text">{{ user.phone }}</p>
          </div>
        </div>
        </div>
      }

      <!-- Network Summary -->
      @if (activeTab === 'network') {
        <div>
        <div class="grid grid-cols-2 gap-4 py-2">
          <div>
            <label class="text-sm text-mlm-secondary">Upline ID</label>
            <p class="font-mono font-medium text-mlm-text">{{ user.upline || 'N/A' }}</p>
          </div>
          <div>
            <label class="text-sm text-mlm-secondary">Total Downlines</label>
            <p class="font-medium text-mlm-text">{{ user.downlinesCount }}</p>
          </div>
          <div>
            <label class="text-sm text-mlm-secondary">Current Rank</label>
            <p class="font-medium text-mlm-text">{{ user.rank }}</p>
          </div>
        </div>
        </div>
      }

      <!-- Wallet Summary -->
      @if (activeTab === 'wallets') {
        <div>
        <div class="space-y-3 py-2">
          <div class="flex items-center justify-between p-3 rounded-lg bg-mlm-background">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-mlm-success/10 flex items-center justify-center">
                <i class="pi pi-wallet text-mlm-success"></i>
              </div>
              <div>
                <p class="font-medium text-mlm-text">Cash Wallet</p>
                <p class="text-xs text-mlm-secondary">Withdrawable</p>
              </div>
            </div>
            <span class="font-semibold text-mlm-text">{{ formatCurrency(user.wallets.cash) }}</span>
          </div>
          <div class="flex items-center justify-between p-3 rounded-lg bg-mlm-background">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-mlm-blue-100 flex items-center justify-center">
                <i class="pi pi-ticket text-mlm-blue-600"></i>
              </div>
              <div>
                <p class="font-medium text-mlm-text">Product Voucher</p>
                <p class="text-xs text-mlm-secondary">Non-Withdrawable</p>
              </div>
            </div>
            <span class="font-semibold text-mlm-text">{{ formatCurrency(user.wallets.productVoucher) }}</span>
          </div>
          <div class="flex items-center justify-between p-3 rounded-lg bg-mlm-background">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-mlm-warning/10 flex items-center justify-center">
                <i class="pi pi-refresh text-mlm-warning"></i>
              </div>
              <div>
                <p class="font-medium text-mlm-text">Autoship Wallet</p>
                <p class="text-xs text-mlm-secondary">Non-Withdrawable</p>
              </div>
            </div>
            <span class="font-semibold text-mlm-text">{{ formatCurrency(user.wallets.autoship) }}</span>
          </div>
        </div>
        </div>
      }

      <!-- Activity Log -->
      @if (activeTab === 'activity') {
        <div>
        <div class="space-y-3 py-2 max-h-[300px] overflow-y-auto">
          @for (activity of user.activityLog; track activity.id) {
            <div class="flex items-start gap-3 pb-3 border-b border-gray-50 last:border-0">
              <div class="w-2 h-2 rounded-full bg-mlm-primary mt-2 flex-shrink-0"></div>
              <div class="flex-1">
                <p class="text-sm text-mlm-text">{{ activity.action }}</p>
                <div class="flex items-center gap-2 mt-1">
                  <span class="text-xs text-mlm-secondary">{{ formatDateTime(activity.timestamp) }}</span>
                  <span class="text-xs text-mlm-secondary">â€¢</span>
                  <span class="text-xs text-mlm-primary">{{ activity.performedBy }}</span>
                </div>
              </div>
            </div>
          }
          @if (user.activityLog.length === 0) {
            <div class="text-center py-8">
              <i class="pi pi-inbox text-3xl text-mlm-secondary/50 mb-2"></i>
              <p class="text-mlm-secondary">No activity recorded</p>
            </div>
          }
        </div>
        </div>
      }
    </div>
  }

  <ng-template pTemplate="footer">
    <div class="flex items-center justify-between">
      <div class="flex gap-2">
        @if (user?.status === 'Active') {
          <button 
            pButton 
            label="Suspend" 
            icon="pi pi-ban"
            class="p-button-danger p-button-outlined"
            (click)="onAction('suspend')">
          </button>
          <button 
            pButton 
            label="Flag" 
            icon="pi pi-flag"
            class="p-button-warning p-button-outlined"
            (click)="onAction('flag')">
          </button>
        }
        @if (user?.status === 'Suspended') {
          <button 
            pButton 
            label="Reactivate" 
            icon="pi pi-check"
            class="p-button-success p-button-outlined"
            (click)="onAction('reactivate')">
          </button>
        }
        @if (user?.status === 'Flagged') {
          <button 
            pButton 
            label="Remove Flag" 
            icon="pi pi-flag-fill"
            class="p-button-outlined"
            (click)="onAction('unflag')">
          </button>
          <button 
            pButton 
            label="Suspend" 
            icon="pi pi-ban"
            class="p-button-danger p-button-outlined"
            (click)="onAction('suspend')">
          </button>
        }
        <button 
          pButton 
          label="Reset Password" 
          icon="pi pi-key"
          class="p-button-secondary p-button-outlined"
          (click)="onAction('resetPassword')">
        </button>
      </div>
      <button 
        pButton 
        label="Close" 
        class="p-button-text"
        (click)="close()">
      </button>
    </div>
  </ng-template>
</p-dialog>

