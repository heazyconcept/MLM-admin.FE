<p-toast></p-toast>

<div class="p-6">
  <!-- Page Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-mlm-text mb-1">User Management</h1>
    <p class="text-mlm-secondary">View and manage all registered users</p>
  </div>

  <!-- Filters Area -->
  <div class="mb-10 pb-8 border-b border-gray-100">
    <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
      <!-- Search Group -->
      <div class="flex-1 max-w-md">
        <div class="relative">
          <i class="pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
          <input 
            type="text" 
            pInputText 
            [ngModel]="globalFilter()"
            (ngModelChange)="globalFilter.set($event)"
            placeholder="Search users..."
            class="w-full pl-10 h-11 border-gray-200 focus:ring-mlm-primary/20 bg-white/50">
        </div>
      </div>

      <!-- Property Filters & Actions -->
      <div class="flex flex-wrap items-center gap-3">
        <p-select 
          [options]="statusOptions"
          [ngModel]="statusFilter()"
          (ngModelChange)="statusFilter.set($event)"
          placeholder="Status"
          optionLabel="label"
          optionValue="value"
          appendTo="body"
          styleClass="w-40 h-11 flex items-center bg-white/50">
        </p-select>

        <p-select 
          [options]="packageOptions"
          [ngModel]="packageFilter()"
          (ngModelChange)="packageFilter.set($event)"
          placeholder="Package"
          optionLabel="label"
          optionValue="value"
          appendTo="body"
          styleClass="w-40 h-11 flex items-center bg-white/50">
        </p-select>

        <p-select 
          [options]="roleOptions"
          [ngModel]="roleFilter()"
          (ngModelChange)="roleFilter.set($event)"
          placeholder="Role"
          optionLabel="label"
          optionValue="value"
          appendTo="body"
          styleClass="w-36 h-11 flex items-center bg-white/50">
        </p-select>

          <p-datepicker 
            [ngModel]="dateRange()"
            (ngModelChange)="dateRange.set($event)"
            selectionMode="range" 
            placeholder="Joined Date Range"
            [showIcon]="true"
            iconDisplay="input"
            appendTo="body"
            styleClass="w-64"
            inputStyleClass="w-full h-11 border-gray-200 bg-white/50"
            panelStyleClass="p-datepicker-premium">
          </p-datepicker>

          <div class="h-8 w-px bg-gray-200 mx-1 hidden sm:block"></div>

        <button 
          pButton 
          icon="pi pi-filter-slash"
          class="p-button-text p-button-secondary h-11 w-11 flex items-center justify-center p-0"
          pTooltip="Clear Filters"
          tooltipPosition="top"
          (click)="clearFilters()">
        </button>
        
        <button 
          pButton 
          label="Export" 
          icon="pi pi-download"
          class="p-button-outlined h-11 px-4 text-sm font-semibold"
          (click)="onExport()">
        </button>
      </div>
    </div>
  </div>

  <!-- Users Table Area -->
  <div class="overflow-x-auto">
    <!-- Data Table -->
    <app-data-table
      [data]="filteredUsers()"
      [columns]="columns()"
      [config]="tableConfig()"
      [actions]="actions()">

      <!-- Custom User Template -->
      <ng-template appDataTableTemplate="fullName" let-row>
        <div class="flex flex-col">
          <span class="font-semibold text-gray-900 leading-tight">{{ row.fullName }}</span>
          <span class="text-xs text-gray-500">&#64;{{ row.username }}</span>
        </div>
      </ng-template>

      <!-- Custom Package Template -->
      <ng-template appDataTableTemplate="package" let-row>
        <span 
          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold tracking-wide uppercase"
          [style.background-color]="getPackageColor(row.package) + '15'"
          [style.color]="getPackageColor(row.package)">
          {{ row.package }}
        </span>
      </ng-template>

      <!-- Custom Status Template -->
      <ng-template appDataTableTemplate="status" let-row>
        <app-status-badge [status]="row.status"></app-status-badge>
      </ng-template>

    </app-data-table>

  </div>
</div>

<!-- User Profile Modal -->
<app-user-profile-modal 
  [visible]="profileModalVisible()"
  (visibleChange)="profileModalVisible.set($event)"
  [user]="selectedUser()"
  (actionClick)="onProfileAction($event)">
</app-user-profile-modal>

<!-- Confirmation Modal -->
<app-confirmation-modal
  [(visible)]="actionConfig.visible"
  [title]="actionConfig.title"
  [message]="actionConfig.message"
  [icon]="actionConfig.icon"
  [iconClass]="actionConfig.iconClass"
  [confirmLabel]="actionConfig.confirmLabel"
  [confirmClass]="actionConfig.confirmClass"
  [showReasonField]="actionConfig.showReasonField"
  [reasonRequired]="actionConfig.reasonRequired"
  (confirm)="onActionConfirm($event)"
  (cancel)="onActionCancel()">
</app-confirmation-modal>
