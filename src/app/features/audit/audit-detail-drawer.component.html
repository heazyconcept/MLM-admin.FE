<p-drawer
  [visible]="visible()"
  (onHide)="onHide()"
  position="right"
  [style]="{ width: '520px' }"
  [modal]="true"
  [closeOnEscape]="true"
  [dismissible]="true">

  <ng-template pTemplate="header">
    <div class="flex items-center justify-between w-full pr-2">
      <span class="font-semibold text-gray-900">Audit Detail</span>
      <span
        class="px-2.5 py-0.5 rounded-full bg-amber-100 text-amber-800 text-xs font-bold uppercase tracking-wide"
        aria-label="Read-only immutable record">
        Immutable
      </span>
    </div>
  </ng-template>

  @if (entry(); as e) {
    <div class="flex flex-col gap-6 pb-6">
      <!-- Full action details -->
      <section>
        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Action details</h3>
        <dl class="grid grid-cols-1 gap-2 text-sm">
          <div>
            <dt class="text-gray-500 font-medium">Timestamp</dt>
            <dd class="text-gray-900 mt-0.5">{{ timestampFormatted() }}</dd>
          </div>
          <div>
            <dt class="text-gray-500 font-medium">Actor</dt>
            <dd class="text-gray-900 mt-0.5">{{ e.actor }}</dd>
          </div>
          <div>
            <dt class="text-gray-500 font-medium">Action</dt>
            <dd class="text-gray-900 mt-0.5">{{ e.action }}</dd>
          </div>
          <div>
            <dt class="text-gray-500 font-medium">Entity</dt>
            <dd class="text-gray-900 mt-0.5">{{ e.entity }}</dd>
          </div>
          <div>
            <dt class="text-gray-500 font-medium">Reference ID</dt>
            <dd class="text-gray-900 mt-0.5 font-mono">{{ e.referenceId }}</dd>
          </div>
          <div>
            <dt class="text-gray-500 font-medium">Description</dt>
            <dd class="text-gray-900 mt-0.5">{{ e.description }}</dd>
          </div>
        </dl>
      </section>

      <!-- Before / After snapshot (read-only) -->
      <section>
        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Before / After snapshot</h3>
        <div class="space-y-3">
          @if (beforeJson(); as before) {
            <div>
              <p class="text-xs font-medium text-gray-500 mb-1">Before</p>
              <pre class="text-xs bg-gray-50 border border-gray-200 rounded-lg p-3 overflow-x-auto text-gray-800 readonly" aria-readonly="true">{{ before }}</pre>
            </div>
          }
          @if (afterJson(); as after) {
            <div>
              <p class="text-xs font-medium text-gray-500 mb-1">After</p>
              <pre class="text-xs bg-gray-50 border border-gray-200 rounded-lg p-3 overflow-x-auto text-gray-800 readonly" aria-readonly="true">{{ after }}</pre>
            </div>
          }
          @if (!beforeJson() && !afterJson()) {
            <p class="text-sm text-gray-500">No snapshot data for this entry.</p>
          }
        </div>
      </section>

      <!-- Related entities -->
      <section>
        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Related entities</h3>
        @if (relatedList().length > 0) {
          <ul class="flex flex-wrap gap-2">
            @for (ref of relatedList(); track ref) {
              <li>
                <span class="inline-block px-2.5 py-1 rounded-md bg-gray-100 text-gray-700 text-xs font-mono">{{ ref }}</span>
              </li>
            }
          </ul>
        } @else {
          <p class="text-sm text-gray-500">None</p>
        }
      </section>

      <p class="text-xs text-gray-400 pt-2 border-t border-gray-100">Read-only. Records are immutable and cannot be edited or deleted.</p>
    </div>
  } @else {
    <p class="text-gray-500 text-sm">No entry selected.</p>
  }
</p-drawer>
