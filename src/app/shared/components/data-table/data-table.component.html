<p-table
  #tableRef
  [value]="data()"
  [paginator]="config().paginator"
  [rows]="config().rows"
  [rowsPerPageOptions]="config().rowsPerPageOptions"
  [showCurrentPageReport]="config().showCurrentPageReport"
  [currentPageReportTemplate]="config().currentPageReportTemplate || 'Showing {first} to {last} of {totalRecords}'"
  [globalFilterFields]="getGlobalFilterFields()"
  [loading]="loading()"
  [showGridlines]="config().showGridlines"
  [styleClass]="tableStyleClass()"
  [tableStyle]="{'min-width': '50rem'}">

  <!-- Caption with global filter -->
  @if (config().globalFilter) {
    <ng-template #caption>
      <div class="flex items-center justify-between gap-4">
        <div class="relative flex-1 max-w-md">
          <i class="pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
          <input
            type="text"
            pInputText
            [ngModel]="globalFilterValue()"
            (ngModelChange)="onGlobalFilterChange($event)"
            [placeholder]="config().globalFilterPlaceholder || 'Search...'"
            class="w-full pl-10 h-11 border-gray-200 focus:ring-mlm-primary/20 bg-white/50" />
        </div>
        <ng-content select="[tableActions]"></ng-content>
      </div>
    </ng-template>
  }

  <!-- Table Header -->
  <ng-template #header>
    <tr>
      @for (column of visibleColumns(); track column.field) {
        <th
          [ngClass]="getHeaderClass(column)"
          [ngStyle]="column.width ? {'width': column.width} : {}">
          {{ column.header }}
        </th>
      }
      @if (hasActions()) {
        <th class="w-20 text-center">Actions</th>
      }
    </tr>
  </ng-template>

  <!-- Table Body -->
  <ng-template #body let-row let-rowIndex="rowIndex">
    <tr class="group">
      @for (column of visibleColumns(); track column.field) {
        <td [ngClass]="getColumnClass(column)">
          @if (column.template) {
            <ng-container
              [ngTemplateOutlet]="column.template"
              [ngTemplateOutletContext]="{$implicit: row, rowIndex: rowIndex}">
            </ng-container>
          } @else {
            {{ getCellValue(row, column) }}
          }
        </td>
      }
      @if (hasActions()) {
        <td class="text-center">
          <div class="flex items-center justify-center gap-1">
            @for (action of actions(); track action.icon) {
              @if (isActionVisible(action, row)) {
                <button
                  pButton
                  [icon]="action.icon"
                  [label]="action.label || ''"
                  [class]="getActionButtonClass(action)"
                  [disabled]="isActionDisabled(action, row)"
                  [pTooltip]="action.tooltip"
                  tooltipPosition="top"
                  (click)="onRowActionClick(action, row)">
                </button>
              }
            }
          </div>
        </td>
      }
    </tr>
  </ng-template>

  <!-- Empty Message -->
  <ng-template #emptymessage>
    <tr>
      <td [attr.colspan]="visibleColumns().length + (hasActions() ? 1 : 0)" class="text-center py-20">
        <div class="flex flex-col items-center">
          <div class="w-20 h-20 rounded-full bg-gray-50 flex items-center justify-center mb-4 border border-gray-100">
            <i [class]="emptyIcon() + ' text-4xl text-gray-300'"></i>
          </div>
          <h3 class="text-lg font-bold text-gray-900">{{ emptyMessage() }}</h3>
          <p class="text-gray-500 mt-1 max-w-xs mx-auto">
            Try adjusting your filters or search terms.
          </p>
          <ng-content select="[emptyActions]"></ng-content>
        </div>
      </td>
    </tr>
  </ng-template>

  <!-- Loading -->
  <ng-template #loadingbody>
    <tr>
      <td [attr.colspan]="visibleColumns().length + (hasActions() ? 1 : 0)">
        <div class="flex items-center justify-center py-8">
          <i class="pi pi-spinner pi-spin text-2xl text-mlm-primary"></i>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>

